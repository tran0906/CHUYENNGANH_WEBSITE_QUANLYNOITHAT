@model SanPham
@{
    ViewData["Title"] = "Chi tiết sản phẩm";
    var images = string.IsNullOrEmpty(Model.Hinhanh) 
        ? new List<string>() 
        : Model.Hinhanh.Split(';', StringSplitOptions.RemoveEmptyEntries).ToList();
}

<div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="bi bi-box-seam"></i> Chi tiết sản phẩm</h2>
    <a asp-action="DanhSach" class="btn btn-secondary">
        <i class="bi bi-arrow-left"></i> Quay lại
    </a>
</div>

<div class="row">
    <!-- Hình ảnh sản phẩm -->
    <div class="col-md-5">
        <div class="card">
            <div class="card-header" style="background:#8B4513;color:white;">
                <i class="bi bi-images"></i> Hình ảnh sản phẩm
            </div>
            <div class="card-body">
                @if (images.Any())
                {
                    <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
                        <div class="carousel-inner">
                            @for (int i = 0; i < images.Count; i++)
                            {
                                var imgPath = images[i].Trim();
                                if (!imgPath.StartsWith("/") && !imgPath.StartsWith("http"))
                                {
                                    imgPath = "/" + imgPath;
                                }
                                <div class="carousel-item @(i == 0 ? "active" : "")">
                                    <img src="@imgPath" class="d-block w-100" style="height: 350px; object-fit: contain; background: #f8f9fa;" 
                                         alt="@Model.Tensp" onerror="this.src='/images/no-image.jpg'" />
                                </div>
                            }
                        </div>
                        @if (images.Count > 1)
                        {
                            <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon bg-dark rounded-circle p-2"></span>
                            </button>
                            <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                                <span class="carousel-control-next-icon bg-dark rounded-circle p-2"></span>
                            </button>
                        }
                    </div>
                    @if (images.Count > 1)
                    {
                        <div class="d-flex gap-2 mt-3 flex-wrap justify-content-center">
                            @for (int i = 0; i < images.Count; i++)
                            {
                                var imgPath = images[i].Trim();
                                if (!imgPath.StartsWith("/") && !imgPath.StartsWith("http"))
                                {
                                    imgPath = "/" + imgPath;
                                }
                                <img src="@imgPath" class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover; cursor: pointer;"
                                     onclick="document.querySelector('#productCarousel').querySelectorAll('.carousel-item')[@i].classList.add('active'); 
                                              document.querySelectorAll('#productCarousel .carousel-item').forEach((el, idx) => { if(idx != @i) el.classList.remove('active'); });"
                                     onerror="this.src='/images/no-image.jpg'" />
                            }
                        </div>
                    }
                }
                else
                {
                    <div class="text-center py-5">
                        <img src="/images/no-image.jpg" class="img-fluid" style="max-height: 300px;" alt="No image" />
                        <p class="text-muted mt-2">Chưa có hình ảnh</p>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Thông tin sản phẩm -->
    <div class="col-md-7">
        <div class="card">
            <div class="card-header" style="background:#8B4513;color:white;">
                <i class="bi bi-info-circle"></i> Thông tin sản phẩm
            </div>
            <div class="card-body">
                <h4 class="mb-3">@Model.Tensp</h4>
                
                <table class="table table-borderless">
                    <tr>
                        <td class="text-muted" style="width: 150px;">Mã sản phẩm:</td>
                        <td><strong>@Model.Masp</strong></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Nhóm sản phẩm:</td>
                        <td>@(Model.ManhomspNavigation?.Tennhomsp ?? "Chưa phân loại")</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Vật liệu:</td>
                        <td>@(Model.MavlNavigation?.Tenvl ?? "Chưa cập nhật")</td>
                    </tr>
                    <tr>
                        <td class="text-muted">Giá bán:</td>
                        <td><span class="fs-5 text-danger fw-bold">@Model.Giaban?.ToString("N0") đ</span></td>
                    </tr>
                    <tr>
                        <td class="text-muted">Số lượng tồn:</td>
                        <td>
                            @if (Model.Soluongton <= 0)
                            {
                                <span class="badge bg-danger fs-6">Hết hàng</span>
                            }
                            else if (Model.Soluongton <= 5)
                            {
                                <span class="badge bg-warning text-dark fs-6">@Model.Soluongton sản phẩm</span>
                            }
                            else
                            {
                                <span class="badge bg-success fs-6">@Model.Soluongton sản phẩm</span>
                            }
                        </td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- Mô tả sản phẩm -->
        <div class="card mt-3">
            <div class="card-header" style="background:#8B4513;color:white;">
                <i class="bi bi-file-text"></i> Mô tả sản phẩm
            </div>
            <div class="card-body">
                @if (!string.IsNullOrEmpty(Model.Mota))
                {
                    <p style="white-space: pre-line;">@Model.Mota</p>
                }
                else
                {
                    <p class="text-muted">Chưa có mô tả</p>
                }
            </div>
        </div>
    </div>
</div>
