@using System.Data
@model DataTable
@{
    ViewData["Title"] = "Khách hàng VIP";
}

<h2 class="mb-4">Khách hàng VIP</h2>

<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-md-3">
                <label class="form-label">Từ ngày</label>
                <input type="date" name="tuNgay" class="form-control" value="@ViewBag.TuNgay" />
            </div>
            <div class="col-md-3">
                <label class="form-label">Đến ngày</label>
                <input type="date" name="denNgay" class="form-control" value="@ViewBag.DenNgay" />
            </div>
            <div class="col-md-3">
                <label class="form-label">Số lượng hiển thị</label>
                <select name="top" class="form-select">
                    <option value="5" selected="@(ViewBag.Top == 5)">Top 5</option>
                    <option value="10" selected="@(ViewBag.Top == 10)">Top 10</option>
                    <option value="20" selected="@(ViewBag.Top == 20)">Top 20</option>
                </select>
            </div>
            <div class="col-md-3">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i> Lọc
                </button>
            </div>
        </form>
    </div>
</div>

<div class="card">
    <div class="card-header d-flex justify-content-between">
        <strong>Top @ViewBag.Top khách hàng chi tiêu nhiều nhất</strong>
        <a asp-action="Index" class="btn btn-sm btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>
    <div class="card-body">
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 50px;">#</th>
                        <th>Mã KH</th>
                        <th>Họ tên</th>
                        <th>SĐT</th>
                        <th>Địa chỉ</th>
                        <th class="text-end">Số đơn hàng</th>
                        <th class="text-end">Tổng chi tiêu</th>
                    </tr>
                </thead>
                <tbody>
                    @if (Model != null && Model.Rows.Count > 0)
                    {
                        int stt = 1;
                        @foreach (DataRow row in Model.Rows)
                        {
                            <tr>
                                <td>
                                    @if (stt <= 3)
                                    {
                                        <span class="badge @(stt == 1 ? "bg-warning" : stt == 2 ? "bg-secondary" : "bg-danger")">
                                            <i class="bi bi-star-fill"></i> @stt
                                        </span>
                                    }
                                    else
                                    {
                                        @stt
                                    }
                                </td>
                                <td>@row["MAKH"]</td>
                                <td><strong>@row["HOTENKH"]</strong></td>
                                <td>@row["SDTKH"]</td>
                                <td>@row["DIACHIKH"]</td>
                                <td class="text-end">@row["SoDonHang"]</td>
                                <td class="text-end text-success fw-bold">@(Convert.ToDecimal(row["TongChiTieu"]).ToString("N0")) đ</td>
                            </tr>
                            stt++;
                        }
                    }
                    else
                    {
                        <tr><td colspan="7" class="text-center text-muted">Không có dữ liệu</td></tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
